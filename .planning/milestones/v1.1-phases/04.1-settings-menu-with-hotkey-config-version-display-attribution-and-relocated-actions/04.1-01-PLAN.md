---
phase: 04.1-settings-menu-with-hotkey-config-version-display-attribution-and-relocated-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Copyhog/Copyhog/Views/SettingsMenu.swift
  - Copyhog/Copyhog/Views/PopoverContent.swift
autonomous: true
requirements:
  - SETTINGS-01
  - SETTINGS-02
  - SETTINGS-03
  - SETTINGS-04

must_haves:
  truths:
    - "A gear icon button appears in the popover toolbar"
    - "Clicking the gear icon opens a settings menu/popover"
    - "Settings menu shows the app version number"
    - "Settings menu shows attribution/credits info"
    - "Hog Wipe action is available in the settings menu with confirmation"
    - "Quit Copyhog action is available in the settings menu"
    - "Hog Wipe button no longer appears in the main toolbar"
    - "Quit Copyhog button no longer appears at the bottom of the popover"
  artifacts:
    - path: "Copyhog/Copyhog/Views/SettingsMenu.swift"
      provides: "Settings menu view with version, attribution, Hog Wipe, Quit"
    - path: "Copyhog/Copyhog/Views/PopoverContent.swift"
      provides: "Cleaned-up popover with gear icon, no Hog Wipe or Quit inline"
  key_links:
    - from: "Copyhog/Copyhog/Views/PopoverContent.swift"
      to: "Copyhog/Copyhog/Views/SettingsMenu.swift"
      via: "Gear button triggers SettingsMenu"
      pattern: "SettingsMenu"
    - from: "Copyhog/Copyhog/Views/SettingsMenu.swift"
      to: "ClipItemStore"
      via: "EnvironmentObject for Hog Wipe"
      pattern: "store\\.removeAll"
---

<objective>
Create a settings menu accessible via a gear icon in the popover toolbar, housing version display, attribution/credits, Hog Wipe, and Quit Copyhog. Remove Hog Wipe and Quit from their current locations to declutter the main popover.

Purpose: Declutter the main popover toolbar while giving users a single place for app info and destructive/utility actions.
Output: SettingsMenu.swift (new view), updated PopoverContent.swift
</objective>

<execution_context>
@/Users/darrenbrelesky/.claude/get-shit-done/workflows/execute-plan.md
@/Users/darrenbrelesky/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@Copyhog/Copyhog/Views/PopoverContent.swift
@Copyhog/Copyhog/Store/ClipItemStore.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SettingsMenu view with version, attribution, Hog Wipe, and Quit</name>
  <files>Copyhog/Copyhog/Views/SettingsMenu.swift</files>
  <action>
Create a new SwiftUI view `SettingsMenu.swift` in the Views directory. This view will be presented as a Menu (using SwiftUI `Menu` with a gear icon label) or as a popover/sheet from the gear button.

Implementation approach — use a SwiftUI `Menu` component so it appears as a dropdown from the gear icon. The menu should contain these sections in order:

1. **Version display** — A disabled label showing "Copyhog v{version}" where version is read from `Bundle.main.infoDictionary?["CFBundleShortVersionString"]`. Fall back to "1.0" if nil.

2. **Attribution** — A disabled label showing "by Darren Brelesky" (or similar credit line).

3. **Divider**

4. **Hog Wipe** — A destructive button labeled "Hog Wipe..." that triggers a confirmation flow. Since this is inside a Menu (which doesn't support .alert), use a @Binding Bool to signal the parent to show the confirmation alert. Accept `showWipeConfirmation: Binding<Bool>` as a parameter.

5. **Quit Copyhog** — A button that calls `NSApplication.shared.terminate(nil)`.

The view should accept `showWipeConfirmation: Binding<Bool>` as an init parameter to communicate the Hog Wipe intent back to PopoverContent (which owns the alert/confirmation state).

Keep the view simple — no @EnvironmentObject needed here since the parent handles the actual wipe.
  </action>
  <verify>
File exists at Copyhog/Copyhog/Views/SettingsMenu.swift. Contains a Menu with gear icon, version from Bundle.main, attribution text, Hog Wipe button, and Quit button. Compiles without errors (verify by building: `xcodebuild -project Copyhog/Copyhog.xcodeproj -scheme Copyhog build 2>&1 | tail -5`).
  </verify>
  <done>SettingsMenu.swift exists with all five elements: version label, attribution label, divider, Hog Wipe button (signals parent via binding), Quit button.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SettingsMenu into PopoverContent and remove relocated actions</name>
  <files>Copyhog/Copyhog/Views/PopoverContent.swift</files>
  <action>
Modify PopoverContent.swift to:

1. **Add gear/settings menu to toolbar** — In the HStack toolbar area (after the multi-select toggle, before the Spacer), add the SettingsMenu as a Menu component. Pass `$showWipeConfirmation` to it. The SettingsMenu will render as a gear icon button that opens a dropdown menu.

2. **Remove the Hog Wipe inline UI from the toolbar** — Delete the entire block that handles `showWipeConfirmation` in the toolbar (the if/else block with "Cancel", "Wipe All", and the trash icon button). The Hog Wipe confirmation will now be triggered by the SettingsMenu setting `showWipeConfirmation = true`.

3. **Add a SwiftUI .alert for Hog Wipe confirmation** — Attach `.alert("Hog Wipe", isPresented: $showWipeConfirmation)` to the main VStack. The alert should have a message "Remove all clipboard items? This cannot be undone." with a destructive "Wipe All" button that calls `store.removeAll()` and resets `selectedItems` and `isMultiSelectActive`, plus a "Cancel" button with role `.cancel`.

4. **Remove the Quit Copyhog section at the bottom** — Delete the entire bottom section: the Divider before it, and the HStack containing the "Quit Copyhog" button and its padding.

After changes, the toolbar should contain only: multi-select toggle button, Spacer, (batch copy button when active), SettingsMenu gear icon. The bottom of the popover should end with the List — no more Quit button.

Keep the `@State private var showWipeConfirmation = false` — it's still needed for the alert binding.
  </action>
  <verify>
Build the project: `xcodebuild -project Copyhog/Copyhog.xcodeproj -scheme Copyhog build 2>&1 | tail -10`. Verify: no "Quit Copyhog" button in PopoverContent body (grep for "Quit Copyhog" should only find it if referenced in SettingsMenu), no inline trash/wipe buttons in toolbar, gear icon menu present, .alert modifier attached.
  </verify>
  <done>PopoverContent toolbar has only multi-select toggle + gear menu. No Quit button at bottom. Hog Wipe accessible only through gear menu with alert confirmation. Project builds successfully.</done>
</task>

</tasks>

<verification>
1. `xcodebuild -project Copyhog/Copyhog.xcodeproj -scheme Copyhog build` succeeds
2. PopoverContent.swift contains no "Quit Copyhog" button in its body
3. PopoverContent.swift contains no inline trash/Hog Wipe buttons in toolbar
4. PopoverContent.swift contains a SettingsMenu reference in the toolbar
5. SettingsMenu.swift contains version display, attribution, Hog Wipe, and Quit
6. Hog Wipe uses .alert confirmation (not inline Cancel/Wipe buttons)
</verification>

<success_criteria>
- Gear icon visible in toolbar opens a dropdown menu
- Menu shows app version, attribution, Hog Wipe, and Quit
- Main toolbar is decluttered (only multi-select toggle + gear)
- Bottom of popover has no Quit button
- Hog Wipe confirmation uses proper alert dialog
- Project compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-settings-menu-with-hotkey-config-version-display-attribution-and-relocated-actions/04.1-01-SUMMARY.md`
</output>
