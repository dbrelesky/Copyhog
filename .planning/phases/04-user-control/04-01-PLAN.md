---
phase: 04-user-control
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Copyhog/Copyhog/CopyhogApp.swift
  - Copyhog/Copyhog/Store/ClipItemStore.swift
  - Copyhog/Copyhog/Views/PopoverContent.swift
  - Copyhog/Copyhog/Views/ItemRow.swift
autonomous: true
requirements: [MGMT-01, MGMT-02]

must_haves:
  truths:
    - "User can delete a single item and it disappears from both UI and persistent store"
    - "User can trigger Hog Wipe, confirm, and all items are removed"
    - "After Hog Wipe the popover shows the empty state message"
  artifacts:
    - path: "Copyhog/Copyhog/Store/ClipItemStore.swift"
      provides: "remove(id:) and removeAll() methods"
      contains: "func remove"
    - path: "Copyhog/Copyhog/Views/PopoverContent.swift"
      provides: "Hog Wipe button with confirmation alert"
      contains: "Hog Wipe"
    - path: "Copyhog/Copyhog/Views/ItemRow.swift"
      provides: "Swipe-to-delete gesture on item rows"
      contains: "onDelete"
  key_links:
    - from: "PopoverContent.swift"
      to: "ClipItemStore.removeAll()"
      via: "Hog Wipe button tap triggers store wipe"
      pattern: "store\\.removeAll"
    - from: "PopoverContent.swift"
      to: "ClipItemStore.remove(id:)"
      via: "List .onDelete modifier triggers single item removal"
      pattern: "store\\.remove"
---

<objective>
Add item management (single delete + full wipe) to give users full control over their clipboard history.

Purpose: Complete the v1.1 milestone by adding the two most-requested management actions.
Output: Swipe-to-delete on items, and Hog Wipe button with confirmation.
</objective>

<execution_context>
@/Users/darrenbrelesky/.claude/get-shit-done/workflows/execute-plan.md
@/Users/darrenbrelesky/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@Copyhog/Copyhog/CopyhogApp.swift
@Copyhog/Copyhog/Store/ClipItemStore.swift
@Copyhog/Copyhog/Views/PopoverContent.swift
@Copyhog/Copyhog/Views/ItemRow.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add store deletion methods</name>
  <files>
    Copyhog/Copyhog/Store/ClipItemStore.swift
  </files>
  <action>
In ClipItemStore.swift, add two new public methods:

1. `func remove(id: UUID)` — Finds the item by ID, calls `cleanupImages(for:)` on it, removes it from the `items` array, and calls `save()`. If the ID is not found, do nothing (no-op).

2. `func removeAll()` — Iterates all items calling `cleanupImages(for:)` on each, then sets `items = []`, then calls `save()`. This ensures all persisted image files are cleaned up before clearing the array.

Both methods must call `save()` at the end to persist the change to items.json.
  </action>
  <verify>
Build the project with `xcodebuild -project Copyhog/Copyhog.xcodeproj -scheme Copyhog -configuration Debug build 2>&1 | tail -5` and confirm BUILD SUCCEEDED. Grep ClipItemStore.swift for `func remove` to confirm both methods exist.
  </verify>
  <done>
ClipItemStore has remove(id:) and removeAll() methods that clean up images and persist changes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire delete UI into PopoverContent and ItemRow</name>
  <files>
    Copyhog/Copyhog/Views/PopoverContent.swift
    Copyhog/Copyhog/Views/ItemRow.swift
  </files>
  <action>
In PopoverContent.swift:

1. Add a `@State private var showWipeConfirmation = false` property.

2. In the toolbar HStack (between the multi-select toggle and Spacer), add a "Hog Wipe" button on the right side (after Spacer, alongside the batch copy button area):
   - Use SF Symbol `"trash"` with `.borderless` button style
   - `.help("Hog Wipe — clear all")` for tooltip
   - On tap, set `showWipeConfirmation = true`

3. Add `.alert("Hog Wipe", isPresented: $showWipeConfirmation)` to the outer VStack:
   - Message: "This will permanently delete all clipboard history items."
   - Destructive action button "Wipe All" calls `store.removeAll()`; also reset `selectedItems.removeAll()` and `isMultiSelectActive = false`
   - Cancel button "Cancel" (default)

4. Change the `List(store.items)` to use `List { ForEach(store.items) { item in ... } .onDelete { indexSet in ... } }` pattern:
   - In the `.onDelete` handler, for each index in indexSet, get the item ID and call `store.remove(id:)`
   - Also remove the deleted item IDs from `selectedItems` if present

In ItemRow.swift — no structural changes needed. The `.onDelete` modifier on ForEach in PopoverContent handles swipe-to-delete natively in SwiftUI List. ItemRow remains a pure row view.

Important: The `.onDelete` modifier gives users the native macOS swipe-to-delete or keyboard Delete key behavior on list rows. This is the standard SwiftUI pattern for list item deletion.
  </action>
  <verify>
Build the project with `xcodebuild -project Copyhog/Copyhog.xcodeproj -scheme Copyhog -configuration Debug build 2>&1 | tail -5` and confirm BUILD SUCCEEDED. Grep PopoverContent.swift for "Hog Wipe" and "removeAll" and "onDelete" to confirm all UI elements are wired.
  </verify>
  <done>
Hog Wipe button appears in toolbar with confirmation alert. Swiping or pressing Delete on a list row removes that single item. After Hog Wipe confirmation, all items are removed and empty state is shown.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds with no errors
2. Single delete: Swipe/Delete key on a row removes it from list and items.json
3. Hog Wipe: Trash button shows confirmation, "Wipe All" clears everything, empty state appears
4. After Hog Wipe, items.json is empty and image files are cleaned up
</verification>

<success_criteria>
- Individual items can be deleted from the history list
- Hog Wipe clears all items after user confirmation
- Empty state displays after full wipe
- All changes persist across app restarts
</success_criteria>

<output>
After completion, create `.planning/phases/04-user-control/04-01-SUMMARY.md`
</output>
