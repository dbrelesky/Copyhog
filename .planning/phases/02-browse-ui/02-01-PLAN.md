---
phase: 02-browse-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Copyhog/Copyhog/Copyhog/Views/PopoverContent.swift
  - Copyhog/Copyhog/Copyhog/Views/PreviewPane.swift
  - Copyhog/Copyhog/Copyhog/Views/ItemRow.swift
autonomous: false

must_haves:
  truths:
    - "Popover shows a scrollable list of captured items with 64x64 thumbnails (images) or 2-line text snippets, each with a relative timestamp"
    - "Hovering over an item row updates the preview pane at the top to show the full-size image or full text"
    - "When no items have been captured, a friendly empty state message is displayed instead of a blank screen"
    - "Default preview shows most recent item when nothing is hovered"
  artifacts:
    - path: "Copyhog/Copyhog/Copyhog/Views/PopoverContent.swift"
      provides: "Top-level layout: empty state vs VStack(PreviewPane + Divider + List)"
      contains: "hoveredItemID"
    - path: "Copyhog/Copyhog/Copyhog/Views/PreviewPane.swift"
      provides: "Full-size image (aspect-fit) or scrollable full text for previewed item"
      contains: "struct PreviewPane"
    - path: "Copyhog/Copyhog/Copyhog/Views/ItemRow.swift"
      provides: "Row with 64x64 thumbnail or text icon, 2-line snippet, relative timestamp, onHover"
      contains: "struct ItemRow"
  key_links:
    - from: "Copyhog/Copyhog/Copyhog/Views/ItemRow.swift"
      to: "PopoverContent.swift"
      via: "@Binding var hoveredItemID: UUID?"
      pattern: "onHover.*hoveredItemID"
    - from: "Copyhog/Copyhog/Copyhog/Views/PreviewPane.swift"
      to: "ImageStore.swift"
      via: "loadImage(relativePath: filePath) for full-size preview"
      pattern: "imageStore\\.loadImage"
    - from: "Copyhog/Copyhog/Copyhog/Views/PopoverContent.swift"
      to: "ClipItemStore.swift"
      via: "@EnvironmentObject var store"
      pattern: "store\\.items"
---

<objective>
Build the browse UI for the Copyhog popover: a preview pane at top showing the full-size content of the hovered item, a scrollable item list at bottom with 64x64 thumbnails and relative timestamps, and an empty state when no items exist.

Purpose: Transform the basic item list from Phase 1 into a usable clipboard browsing experience with hover-driven preview.
Output: Refactored PopoverContent.swift + new PreviewPane.swift and ItemRow.swift
</objective>

<execution_context>
@/Users/darrenbrelesky/.claude/get-shit-done/workflows/execute-plan.md
@/Users/darrenbrelesky/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-browse-ui/02-RESEARCH.md
@Copyhog/Copyhog/Copyhog/Views/PopoverContent.swift
@Copyhog/Copyhog/Copyhog/Models/ClipItem.swift
@Copyhog/Copyhog/Copyhog/Store/ClipItemStore.swift
@Copyhog/Copyhog/Copyhog/Services/ImageStore.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor PopoverContent into split-view layout with PreviewPane, ItemRow, and empty state</name>
  <files>
    Copyhog/Copyhog/Copyhog/Views/PopoverContent.swift
    Copyhog/Copyhog/Copyhog/Views/PreviewPane.swift
    Copyhog/Copyhog/Copyhog/Views/ItemRow.swift
  </files>
  <action>
Create two new SwiftUI view files and refactor PopoverContent.swift:

**PreviewPane.swift** — New file in Views/:
- Struct `PreviewPane: View` accepting `let item: ClipItem?` and `let imageStore: ImageStore`
- When item is image type: load full-size image via `imageStore.loadImage(relativePath: item.filePath!)`, display with `Image(nsImage:).resizable().aspectRatio(contentMode: .fit)` centered in the frame
- When item is text type: show `item.content` in a `ScrollView` with `.font(.body)` and `.padding(12)`, left-aligned, full-width
- When item is nil: show `Color.clear`
- Wrap content in `Group` with `.frame(maxWidth: .infinity, maxHeight: .infinity)` and `.background(Color(nsColor: .controlBackgroundColor))`

**ItemRow.swift** — New file in Views/:
- Struct `ItemRow: View` accepting `let item: ClipItem`, `let imageStore: ImageStore`, `@Binding var hoveredItemID: UUID?`
- For image items: load thumbnail via `imageStore.loadImage(relativePath: item.thumbnailPath!)` at `frame(width: 64, height: 64)` with `.clipShape(RoundedRectangle(cornerRadius: 6))` and `.aspectRatio(contentMode: .fill)`
- For text items: show `Image(systemName: "doc.text")` in a 64x64 frame with `Color.secondary.opacity(0.1)` background and rounded corners
- Content area: `VStack(alignment: .leading)` with `Text(item.content ?? "")` at `.lineLimit(2).font(.caption)` for text items. For image items without text content, optionally show nothing or a placeholder label.
- Trailing: `Text(item.timestamp, style: .relative).font(.caption2).foregroundStyle(.tertiary)`
- Apply `.onHover { hovering in hoveredItemID = hovering ? item.id : nil }` on the row HStack
- Add `.padding(.vertical, 4)` for row spacing
- Add a subtle highlight when `hoveredItemID == item.id` — e.g. `.background(hoveredItemID == item.id ? Color.secondary.opacity(0.1) : Color.clear)` with `.clipShape(RoundedRectangle(cornerRadius: 6))`

**PopoverContent.swift** — Refactor existing file:
- Add `@State private var hoveredItemID: UUID?`
- Add computed property `previewItem: ClipItem?` that returns the item matching `hoveredItemID`, falling back to `store.items.first` (most recent) when nothing is hovered
- Empty state: replace existing VStack with `ContentUnavailableView("No Clips Yet", systemImage: "clipboard", description: Text("Copy text or take a screenshot to get started"))`
- Non-empty state: `VStack(spacing: 0)` containing `PreviewPane(item: previewItem, imageStore: store.imageStore).frame(height: 200)`, then `Divider()`, then `List(store.items) { item in ItemRow(item: item, imageStore: store.imageStore, hoveredItemID: $hoveredItemID) }` with `.listStyle(.plain)`
- Keep `.frame(width: 360, height: 480)` on the outermost container
- Keep the #Preview at the bottom

Important notes from research:
- Rows MUST use `thumbnailPath` (64x64), NOT `filePath` — only PreviewPane loads full-size images
- Use `.listStyle(.plain)` on the List for minimal chrome
- The "last writer wins" pattern for onHover handles the known macOS exit-callback bug
  </action>
  <verify>
Build the project: open Copyhog.xcodeproj in Xcode and build (Cmd+B), or run `xcodebuild -project Copyhog/Copyhog/Copyhog.xcodeproj -scheme Copyhog build` from the terminal. Must compile with zero errors.
  </verify>
  <done>
Three view files exist (PopoverContent.swift refactored, PreviewPane.swift created, ItemRow.swift created). Project compiles. PopoverContent uses ContentUnavailableView for empty state, VStack(PreviewPane + Divider + List(ItemRow)) for non-empty state, with @State hoveredItemID driving preview selection.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify browse UI in running app</name>
  <what-built>Split-view popover with preview pane (top), scrollable item list with 64x64 thumbnails (bottom), hover-driven preview, and empty state.</what-built>
  <how-to-verify>
    1. Launch Copyhog from Xcode (Cmd+R)
    2. **Empty state test:** If no items captured yet, click the hedgehog menu bar icon — should see "No Clips Yet" with clipboard icon and description text (not a blank screen)
    3. **Capture some items:** Copy a few pieces of text (Cmd+C in any app) and take a screenshot (Cmd+Shift+4). Wait 1-2 seconds for captures.
    4. **Item list test:** Open the popover — should see a scrollable list at the bottom with:
       - 64x64 image thumbnails for screenshots/images (rounded corners)
       - Text icon + 2-line text snippets for text items
       - Relative timestamps on the right ("just now", "2 min ago")
    5. **Preview pane test:** The top ~200pt should show the most recent item's full content by default
    6. **Hover test:** Move your mouse over different rows in the list — the preview pane at top should update to show the hovered item's full-size image (aspect-fit) or full text (scrollable)
    7. **Hover highlight:** The currently hovered row should have a subtle background highlight
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- Project builds with zero errors via xcodebuild
- Empty state shows ContentUnavailableView (not blank)
- Item list rows show 64x64 thumbnails, not 120x120
- Preview pane updates on hover
- Default preview is most recent item
- Full-size images only loaded for previewed item, not all rows
</verification>

<success_criteria>
1. The popover shows a scrollable list with 64x64 thumbnails (images) or 2-line text snippets with relative timestamps
2. Hovering an item row updates the top preview pane to show full-size image or full text
3. Empty state displays a friendly message with clipboard icon
4. Human verification confirms all three behaviors work in the running app
</success_criteria>

<output>
After completion, create `.planning/phases/02-browse-ui/02-01-SUMMARY.md`
</output>
